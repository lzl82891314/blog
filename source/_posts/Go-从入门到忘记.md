---
title: Go, 从入门到忘记
url_name: go-startup
date: 2021-11-14 15:21:38
hidden: true
categories:
  - Go
tags:
  - 入门
  - 基础知识
---

差不多整整一年前，当时在云组做了一个[Docker 和 Kubernetes 的培训](https://www.dunbreak.cn/2020/12/31/docker-and-kubernetes/)，当时就发现，云原生相关的组件几乎都是用 Go 写的，本着努力成为一个云原生程序员（笑）的目标，当时夸下海口说未来半年的考评任务要学会 Go 去看 Kubernetes 源码，然后就没有然后了……

<!--more-->

Go 最开始吸引我的是它号称`互联网时代的C语言`，第一次听到这个宣传语时，我下意识的以为 Go 是一门和 C 语言一样性能强大并且且可以直接操作硬件的语言。好家伙，学了之后才发现这句话的意思是说 Go 和 C 一样原始……

![hello-go](https://image.dunbreak.cn/go/hello-go.jpg)

作为一个 C#er，第一次看到 Go 的语法真是难受的浑身不爽，先不说别的，就单看这个 main 函数我就能发现奇怪的宝藏：`printf` + `%s`这种语法我可能大学毕业就再也没有用过了，然而这种过时的语法既然还能在 Go 这种 2007 年才发布的语言中看到，并且这种写法还是唯一支持的写法……

加之想到之前由于没有学习 Go Module 相关的内容导致我一个 main 函数都跑不起来的尴尬过往，说实话一年前夸下海口之后我是打算放弃的。

直到今年下半年，Barry 说要我做一个 Go 语言的培训我才重新开始学习 Go（果然 Deadline 才是第一生产力）。不过还好，当把所有 Go 的语法都学完并且自己动手写了一个小项目之后，发现 Go 语言中独特的抽象设计完全是给我打开了一扇新的大门，并且一切极简自己动手的风格也完全契合我想自己动手写点东西提高自己的想法，果然人人都是王境泽。

## 还是从头说起

### Go 是怎样诞生的？

果然我就是一个学任何东西都喜欢刨根问底的人（看书必看序，学习必须从诞生开始…），所以最开始还是来看看 Go 到底是如何诞生的。

话说早在 2007 年 9 月的一天，Google 工程师 [Rob Pike](https://en.wikipedia.org/wiki/Rob_Pike) 和往常一样启动了一个 C++项目的构建，按照他之前的经验，这个构建应该需要持续 1 个小时左右。这时他就和 Google 公司的另外两个同事 [Ken Thompson](https://en.wikipedia.org/wiki/Ken_Thompson) 以及 [Robert Griesemer](https://en.wikipedia.org/wiki/Robert_Griesemer) 开始吐槽并且说出了自己想搞一个新语言的想法。当时 Google 内部主要使用 C++构建各种系统，但 C++复杂性巨大并且原生缺少对并发的支持，使得这三位大佬苦恼不已。

![authors](https://image.dunbreak.cn/go/authors.png)

第一天的闲聊初有成效，他们迅速构想了一门新语言：能够给程序员带来快乐，能够匹配未来的硬件发展趋势以及满足 Google 内部的大规模网络服务。并且在第二天，他们又碰头开始认真构思这门新语言。第二天会后，Robert Griesemer 发出了如下的一封邮件：

![plan-email](https://image.dunbreak.cn/go/plan-email.webp)

可以从邮件中看到，他们对这个新语言的期望是：**在 C 语言的基础上，修改一些错误，删除一些诟病的特性，增加一些缺失的功能。**比如修复 Switch 语句，加入 import 语句，增加垃圾回收，支持接口等。而这封邮件，也成了 Go 的第一版设计初稿。

在这之后的几天，Rob Pike 在一次开车回家的路上，为这门新语言想好了名字`Go`。在他心中，"Go"这个单词短小，容易输入并且可以很轻易地在其后组合其他字母，比如 Go 的工具链：goc 编译器、goa 汇编器、gol 连接器等，并且这个单词也正好符合他们对这门语言的设计初衷：简单。

> Go 从头到尾一直其实只有这一个名字，而现在人们知道的名字大多是 Golang，这其实是错的。Golang 其实是因为 Go 语言原本想要的官网域名 `https://www.go.org` 被占用了，无奈使用了 `https://www.golang.org`。此外，早起由于 Go 这个单词太普世了，导致搜索引擎很难搜索到 Go 语言相关的内容，所以 Golang 也有 SEO 的作用。但是不管这些，这门语言的名字就是 Go。

### 逐步成型

在统一了 Go 的设计思路之后，Go 语言就正式开启了语言的设计迭代和实现。

2008 年，C 语言之父，大佬肯·汤普森实现了第一版的 Go 编译器，这个版本的 Go 编译器还是使用 C 语言开发的，其主要的工作原理是将 Go 编译成 C，之后再把 C 编译成二进制文件。到 2008 年年中，Go 的第一版设计就基本结束了。这时，同样在谷歌工作的伊恩·泰勒（Ian Lance Taylor）为 Go 语言实现了一个 gcc 的前端，这也是 Go 语言的第二个编译器。

伊恩·泰勒的这一成果不仅仅是一种鼓励，也证明了 Go 这一新语言的可行性 。有了语言的第二个实现，对 Go 的语言规范和标准库的建立也是很重要的。随后，伊恩·泰勒以团队的第四位成员的身份正式加入 Go 语言开发团队，后面也成为了 Go 语言，以及其工具设计和实现的核心人物之一。

罗斯·考克斯（Russ Cox）是 Go 核心开发团队的第五位成员，也是在 2008 年加入的。进入团队后，罗斯·考克斯利用函数类型是“一等公民”，而且它也可以拥有自己的方法这个特性巧妙设计出了 http 包的 HandlerFunc 类型。这样，我们通过显式转型就可以让一个普通函数成为满足 http.Handler 接口的类型了。不仅如此，罗斯·考克斯还在当时设计的基础上提出了一些更泛化的想法，比如 io.Reader 和 io.Writer 接口，这就奠定了 Go 语言的 I/O 结构模型。后来，罗斯·考克斯成为 Go 核心技术团队的负责人，推动 Go 语言的持续演化。到这里，Go 语言最初的核心团队形成，Go 语言迈上了稳定演化的道路。

### 正式发布

2009 年 10 月 30 日，罗伯·派克在 Google Techtalk 上做了一次有关 Go 语言的演讲，这也是 Go 语言第一次公之于众。十天后，也就是 2009 年 11 月 10 日，谷歌官方宣布 Go 语言项目开源，之后这一天也被 Go 官方确定为 Go 语言的诞生日。

![published](https://image.dunbreak.cn/go/published.webp)

在 Go 开源后，它也有了一个属于自己的吉祥物 Gopher：

![Gopher](https://image.dunbreak.cn/go/gopher.webp)

Gopher 是一种地鼠，是 Rob Pike 的老婆设计的（写代码的人还有家人的支持，真是羡慕了笑），从此 Gopher 也成了世界各地 Go 程序员的象征。

### 运营至今

其实由于 Google 公司做背书，Go 在刚发布开始还是比较火热的。但是随时认识了解它的人越来越多，Go 的各种问题也逐步暴露了出来，比如：Go 最开始的设计只是为了解决 Google 公司自己内部的一些项目构建问题，其内部的系统是一个巨石架构，几乎不存在包依赖的问题，因此包依赖这个问题并没有在最开始成为 Go 开发团队的主要任务。

然而没有包管理的项目是恐怖的，在最开始的版本，Go 只支持 Go Env 的包管理模式，这种模式下，我们写的代码必须放在 Go 安装时设置的 Go Env 目录下。这几乎简直是一个反人类的设计，也是最开始我连一个 hello, world 都编译不成功的主要原因。

除此之外，由于没有包依赖管理，最开始 Go 项目的包是没有版本的概念的，也就导致了大多数的项目很难运行起来。随后，Go 团队引入了 vendor 模式，试图去解决这个问题，但是都只是杯水车薪。直到 Go1.11 的 Go Module 发布之后，Go 才彻底解决了包依赖的问题。

![main-version](https://image.dunbreak.cn/go/main-version.webp)

从上面的 Go 的几个主要版本可以看到，明年 2 月左右发布的 Go 1.18 版本将支持泛型，这也说明 Go 正在逐步成为一门更主流的语言。

## 学会打洞

Go 是一门致力于简单的语言，从最开始的 Hello, World 函数中我们可以大概知道如下几个概念：

1. 和 C#一样，块和块之前是由大括号区分的（不像 Python 那种面向游标卡尺编程的语言）
2. 和 C#不同，语句之后不用跟分号，如果加了，会自动被 Go 原生自带的代码格式化工具 gofmt 删掉 (go 从源头上根治了左括号到底换不换行这一世纪难题)
3. 同样和 C#不同，函数是一等公民，程序以包作为拆分载体，而不是 C#中以类和程序集。在 Go 中，文件可以大概等同于 C#的 Class；包可以大概等同于 C#的程序集。这个概念以我浅显的理解应该和 JavaScript 相同

好了，有了上述这些基础的概念，我们就可以正式学习如何当一名合格的地鼠了。不过，既然我们都已经是成熟的 C#er 了，那学习 Go 肯定不能从 int 是什么意思说起了，如何找一个切入点呢？

Go 的简单从关键字的个数上就可以很好的体现出来了。

Go 一共只有可怜的`25个关键字`，而我数了数 C#的，好家伙，基础关键字就有`77个`，除此之外还有`42个上下文关键字！`一共有 119 个关键字，这几乎是 Go 的 5 倍之多！

既然这样，那就以关键字为切入点，主要对比学习一下 Go 和 C#的关键字有哪些差别，进而来全面地学习一下 Go 的语法。为此，我主要把 Go 和 C#的关键字进行了分类，来按类别学习这些关键字的异同。

### 咱俩都有的

- break
- case
- const
- continue
- default
- else
- for
- if
- interface
- return
- switch
- var

以上的 12 个关键字是 Go 和 C#共有的，它们之中大部分的用法都是完全相同的，这里主要说一下 Go 中有特殊语法的关键字。

#### var

首先，让我们来看看参数定义关键字 var。

var 的意思同样也是定义变量，但是定义变量的语法和 C#有所不同。C#中只有一种定义变量的方法，而 Go 中有两种，它们分别是：

- 普通方式

```go
var i int = 1
```

这种方式是 Go 的原始变量定义方式，一般包级别的变量都是这样定义的，并且如果定义那些编译器可以自动推断的类型，比如上述的例子，其后的类型可以省略。

由此可知，Go 中 var 就是申明一个变量，而这个变量是什么类型，需要在变量名之后指明。

- 语法糖(是的，Go 中也有语法糖…)

```go
i, j := 1, "hello"
```

上述的代码可以简写为这种语法糖形式，Go 代码中，90%的变量都是以这样的方式定义的，因为 Go 中几乎所有的函数都会存在多余一个的返回值，这样的定义可以省去很大功夫。

#### switch-case-default

switch-case 是一个连用的子句，但是 case 和 default 这两个关键字在 Go 中除了可以和 switch 连用，还可以和后面会讲到的 select 语句连用。

Go 中默认把 switch 语句的一个弊端修复了，即 switch 子句中不用再写 break 了：

```go
switch n := "a"; n {
  case n == "a":
    fmt.Println("a")
  case n == "b":
    fmt.Println("b")
  case n == "c":
    fmt.Println("c")
}
```

> 上面这段代码的 fmt 是标准输出包，其中的`Println`函数等同于 C#中的`Console.WriteLine`方法。

这段代码的最终结果只会输出`a`，而 C#中这样的代码会把 abc 全部输出出来，这样的改动确实比较省心。

除此之外，switch 语句后面出现了一个比较奇怪的写法`n := "a"; n`，在 Go 中的控制语句（if, else if, switch-case, for）都可以加入这样的控制块作用域代码，如此这样写的话，这个变量 n 就只能在 switch 语句中生效。分号之前是变量的定义，分号之后是定义的判断条件。

这种语法优点类似于 C#中的普通 for 循环的前两个子句。

最后，我们可以看到 switch 之后没有跟小括号，在 Go 中，控制块的子句后面都是不需要写小括号的，如果写了同样会被 gofmt 自动格式化掉。

#### for

Go 中的循环控制语句`有且只有`一个 for 关键字。而 C#中的 while、foreach 等在 Go 中都是通过 for 的各种变形达成的。

- while 语句

```go
for true {
  // ...
}
```

- for 语句

```go
for i := 0; i < n; i++ {
  // ...
}
```

Go 中普通的 for 循环和 C#几乎没有差别，唯一的差别就是 `i++从表达式变成了语句`。

这句话的意思是，Go 的代码中不能写`i = i++`这样的代码。

此外，也没有`++i`这样的语法，只有`i++`

- foreach 语句

```go
array := [5]int{1, 2, 3, 4, 5}
for index, value := range array {
  // ...
}
```

> 这个例子中用到了数组的初始化代码，数组会在后面单独说明，这里只是作为一个例子展示。

foreach 语句的写法和 C#中很不相同，上述的例子是 foreach 遍历一个 int 类型的数组，其中用到了一个`range`关键字，这个关键字会把数组拆分成两个迭代子对象 index 和 value，这个语法同样类似于 JavaScript 的循环语法。

#### 其他

1. return 关键字和 C#功能是相同的，这里拿出来是要说一下，Go 中的 return 同样也可以同时返回多个结果，Java 没有这样的语法代码写起来实在是费劲。
2. interface 没讲，这个关键字和 C#相同都是定义接口的，而 Go 中的接口实现方式和 C#完全不同，需要在后面详细说明，所以这里就简单带过。

其余没有说明的关键字用法和 C#完全相同，就不一一说明了。

### 虽然不太一样但是意思差不多的

Go 和 C#中还有几个相似用法的关键字，但是它们的名字不太相同，这里可以大概了解一下做一个对应即可。

#### package 和 namespace
